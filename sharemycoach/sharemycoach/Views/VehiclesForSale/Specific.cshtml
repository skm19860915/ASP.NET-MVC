<!--Vehicles For Sale Specific View-->
<link href="~/Content/css/home.css" rel="stylesheet" />
<link href="~/Content/css/listview.css" rel="stylesheet" />
<div class="row">
    <div class="row pre-header" style="padding-top:0px;">
        <hr class="top-separate-line" />
        <div id="vehicles-for-sale-header"></div>
        <div id="vehicles-for-sale-body"></div>
        <div id="vehicles-for-sale-footer"></div>
    </div>
    <!--START video range-->
    @Html.Partial("~/Views/Shared/_VideoSection.cshtml")
    <!--END video range-->
</div>

<script type="text/javascript">
    $(document).ready(function () {
        var search_location_id = @ViewBag.SearchLocationSequenceId;
        if(search_location_id > 0){
            LoadVehicleForSalePage(search_location_id);
        }
        else{
            var sequence_id = sessionStorage.getItem("CurrentLocationSequenceId");
            LoadVehicleForSalePage(sequence_id);
        }
    });

    function LoadVehicleForSalePage(id)
    {
        var webapi_path = '@System.Configuration.ConfigurationManager.AppSettings["RMXWebService"]';
        var dirs = '@ViewBag.DirNames';
        var dir_arr = dirs.split(',');
        var is_found = false;
        for (var i = 0; i < dir_arr.length; i++) {
            if (id == dir_arr[i]) {
                is_found = true;
                break;
            }
        }
        if (is_found) 
        {
            $("#vehicles-for-sale-header").load('../UserContent/' + id + '/Buy_an_RV/Header.html', function (response, status, xhr) {
                if (status == "error") { console.log("Not found Header.html...."); }
            });
            $("#vehicles-for-sale-body").load('../UserContent/' + id + '/Buy_an_RV/Buy_an_RV.html', function (response, status, xhr) {
                if (status == "success") 
                {
                    $("#secondary-vehicle-list").css('display', 'none');

                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: webapi_path + "salefeatured/" + id + "?token=AIzaSyAJSErr4vFLsOoylqQYkfQLKM26lnsHLXY",
                        success: function(data)
                        {
                            jsonValue = jQuery.parseJSON(JSON.stringify(data));
                            getVehiclesForSale(jsonValue);
                        },
                        error: function(error){ console.log(error.responseText); }
                    });
                }
                if(status == "error"){ console.log("buy_an_rv file loading error...."); }
            });
            $("#vehicles-for-sale-footer").load("../UserContent/" + id + "/Buy_an_RV/Footer.html", function(response, status, xhr){
                if(status == "error"){ console.log("footer file loading error....."); }
            });
        }
        else
        {
            $("#vehicles-for-sale-header").load("../UserContent/Common/Buy_an_RV/Header.html", function(response, status, xhr){
                if(status == "success")
                {
                    $.ajax({
                        type: "GET",
                        dataType: "json",
                        url: webapi_path + "location" + "?token=AIzaSyAJSErr4vFLsOoylqQYkfQLKM26lnsHLXY",
                        success: function(data)
                        {
                            jsonValue = jQuery.parseJSON(JSON.stringify(data));
                            getLocationList(jsonValue);
                        },
                        error: function(error){ console.log(error.responseText); }
                    });
                }
                if(status == "error"){ console.log("header file loading error...."); }
            })
        }
    }

    function getLocationList(obj)
    {
        //console.log(obj);
        var website = '@System.Configuration.ConfigurationManager.AppSettings["WebSite"]';
        var list = '';
        if(obj.length > 0){
            for(var i = 0; i < obj.length; i++){
                list += '<li><a class="nolineA" href="' + website + 'VehiclesForSale?location=' + obj[i].State + '-' + obj[i].City + '">' + obj[i].City + ', ' + obj[i].State + '</a></li>';
            }
        }
        else{
            list = '<h3 style="color:red;">Not Found Location Informations !</h3>';
        }

        document.getElementById('location-list').innerHTML = list;
    }

    function getVehiclesForSale(obj) {
        //console.log(obj);
        var primary_html = '', secondary_html = '';
        for (var i = 0; i < obj.length; i++)
        {
            primary_html += GeneratePrimaryVehicleList(obj[i]);
            secondary_html += GenerateSecondaryVehicleList(obj[i]);
        }
        if (primary_html) {
            document.getElementById('primary-vehicle-list').innerHTML = '<br/>' + primary_html;
        }
        else {
            document.getElementById('primary-vehicle-list').innerHTML = 
                '<br/><br/><h4 style="color:red; font-style:italic; text-align:center;">Please check back soon.<br /> There are currently no vehicles for sale</h4><br/><br/><br/><br/>';
        }
        if (secondary_html) {
            document.getElementById('secondary-vehicle-list').innerHTML = '<br/>' + secondary_html;
        }
        else {
            document.getElementById('secondary-vehicle-list').innerHTML = 
                '<br/><br/><h4 style="color:red; font-style:italic; text-align:center;">Please check back soon.<br /> There are currently no vehicles for sale</h4><br/><br/><br/><br/>';
        }
    }

    function GetCurrency(value)
    {
        if (value) {
            var currency = '$' + value.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
            return currency;
        }
        else {
            return "$0";
        }
    }

    function GeneratePrimaryVehicleList(list)
    {
        var currency = GetCurrency(list.SalePrice);
        var photo_div = '', desc_div = '', name_div = '', daily_div = '', description_div = '', email_div = '';
        photo_div = '<a href="Vehicle-Sale/'+ list.WebUniqueId + '"><img src="data:image/jpg;base64, ' + list.Photo + '" class="img-responsive vehicle-list-img" style="padding-left:0px;" /><br/></a>';
        name_div = '<div class="row daily-div"><div class="col-lg-12"><h4>' + list.Name + '</h4></div></div>';
        daily_div = '<div class="row daily-div"><div class="col-lg-3"><h5>Seller: ' + list.WebForSaleSellerName + '</h5></div>'
                    + '<div class="col-lg-4 col-md-4 col-sm-4" style="margin-top:14px;"><span style="color:black;">TEL : </span><a href="#">' + list.PrimaryPhone + '</a></div>'
                    + '<div class="col-lg-5 col-md-5 col-sm-5"><h5>Price: ' + currency + '</h5></div></div>';
        description_div = '<div class="row description"><span>' + list.ForSaleDesc + '</span></div>';
        email_div = '<div class="row daily-div"><div class="col-lg-7 col-md-7 col-sm-7"><h5 style="padding-top:0px;">' + list.PrimaryEmail + '</h5></div>'
                    + '<div class="col-lg-5 col-md-5 col-sm-5" style="text-align:center;"><a href="Vehicle-Sale/'+ list.WebUniqueId + '" class="btn btn-danger">Details</a></div></div>';

        desc_div = '<div class="listview-div" style="margin-left:0px; margin-right:0px;">' + name_div + daily_div + description_div + email_div + '</div>';

        var g_html = '<div class="row" style="padding-bottom:20px;"><div class="col-lg-4 col-md-4">' + photo_div + '</div><div class="col-lg-8 col-md-8">' + desc_div + '</div></div>';
        return g_html;
    }

    function GenerateSecondaryVehicleList(list)
    {
        var g_name, g_photo;
        var currency = GetCurrency(list.SalePrice);
        if(list.IsSquarePhoto == true){
            g_photo = '<img src="data:image/jpg;base64, ' + list.Photo + '" class="clip-vehicle-img" />';
            g_name = '<h5 class="vehicle-license" style="margin-top:137px;">' + list.Name + '</h5>';
        }
        else{
            g_photo = '<img src="data:image/jpg;base64, ' + list.Photo + '" class="vehicle-img" />';
            g_name = '<h5 class="vehicle-license">' + list.Name + '</h5>';
        }
        var tile = '<div class="vehicle-div" style="text-align:center; height:230px;"><a href="Vehicle-Sale/' + list.WebUniqueId + '">' +
                    g_photo + g_name + '<p class="vehicle-price" style="margin-top:5px;">Price: ' + currency + '</p></a></div><br/>';

        var g_html = '<div class="col-lg-3 col-md-3 col-sm-4 vehicle-info">' + tile + '</div>';
        return g_html;
    }

    function ViewPrimaryVehicleList()
    {
        $('#primary-vehicle-list').css('display', 'block');
        $('#secondary-vehicle-list').css('display', 'none');
    }

    function ViewSecondaryVehicleList()
    {
        $('#primary-vehicle-list').css('display', 'none');
        $('#secondary-vehicle-list').css('display', 'block');
    }
</script>
